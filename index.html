<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>من سيربح المليون</title>
    <script src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.js"></script>
    <script src="https://cdn.tailwindcss.com/dist/cdn.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.js"></script>
    <script type="module" src="https://unpkg.com/lucide@latest"></script>
    <style>
        /* خط مخصص للغة العربية */
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap');

        body {
            font-family: 'Cairo', sans-serif;
            background: linear-gradient(to bottom, #0f0c29, #302b63, #24243e);
            color: white;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            overflow: hidden; /* منع التمرير الزائد */
        }

        /* تصميم مشابه لواجهة البرنامج */
        #app {
            width: 100%;
            max-width: 900px; /* تحديد عرض أقصى */
            margin: auto;
            padding: 20px;
            background-color: rgba(0, 0, 0, 0.6); /* خلفية شبه شفافة */
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            border: 2px solid #ffd700; /* إطار ذهبي */
        }

        .question-container {
            background-color: rgba(40, 40, 90, 0.8);
            border: 2px solid #6a5acd; /* إطار بنفسجي */
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            text-align: center;
            box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.5);
        }

        .options button {
            display: block;
            width: 100%;
            margin-bottom: 10px;
            padding: 15px;
            background: linear-gradient(to right, #4a00e0, #8e2de2); /* تدرج بنفسجي */
            color: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            text-align: right; /* محاذاة النص لليمين */
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1rem; /* حجم خط مناسب */
        }

        .options button:hover:not(:disabled) {
            background: linear-gradient(to right, #5e17e8, #a045e8);
            transform: scale(1.02);
            box-shadow: 0 5px 15px rgba(255, 215, 0, 0.3); /* ظل ذهبي عند المرور */
        }

        .options button.selected {
            background: linear-gradient(to right, #ff8c00, #ffa500); /* برتقالي للإجابة المختارة */
            border-color: #ffd700;
        }

        .options button.correct {
            background: linear-gradient(to right, #00b09b, #96c93d); /* أخضر للإجابة الصحيحة */
            animation: pulse-correct 1s infinite;
        }

        .options button.incorrect {
            background: linear-gradient(to right, #d31027, #ea384d); /* أحمر للإجابة الخاطئة */
            animation: shake-incorrect 0.5s;
        }

        .options button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .lifelines button {
            background-color: #6a5acd; /* بنفسجي */
            border: 1px solid #ffd700; /* ذهبي */
            padding: 8px 12px;
            margin: 0 5px;
            border-radius: 5px;
            transition: background-color 0.3s ease;
        }
        .lifelines button:hover:not(:disabled) {
            background-color: #836fff;
        }
        .lifelines button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            background-color: #444; /* رمادي داكن عند التعطيل */
            border-color: #666;
        }
        .lifelines button.used {
             text-decoration: line-through; /* خط يتوسط النص للإشارة للاستخدام */
        }

        .progress-bar {
            background-color: #444;
            border-radius: 5px;
            overflow: hidden;
            height: 20px;
            margin-bottom: 15px;
            border: 1px solid #666;
        }

        .progress-bar-inner {
            height: 100%;
            background: linear-gradient(to right, #ffd700, #f0a500); /* تدرج ذهبي */
            transition: width 0.5s ease;
            text-align: center;
            color: #333;
            font-weight: bold;
            line-height: 20px; /* لمركزة النص عمودياً */
        }

        .money-tree {
            list-style: none;
            padding: 0;
            margin: 0 0 20px 0;
            text-align: center;
        }
        .money-tree li {
            padding: 5px;
            margin-bottom: 3px;
            border-radius: 5px;
            background-color: rgba(0, 0, 0, 0.3);
            color: #ccc; /* لون رمادي فاتح */
            transition: all 0.3s ease;
        }
        .money-tree li.current {
            background-color: #ffd700; /* ذهبي للسؤال الحالي */
            color: #302b63; /* لون النص داكن */
            font-weight: bold;
            transform: scale(1.05);
        }
         .money-tree li.safe-haven {
            border: 1px dashed #96c93d; /* إطار أخضر متقطع للمراحل الآمنة */
        }

        .timer {
            font-size: 1.5rem;
            font-weight: bold;
            color: #ffa500; /* برتقالي */
            margin-bottom: 15px;
        }

        .final-answer-btn {
            background: linear-gradient(to right, #ff4e50, #f9d423); /* تدرج أحمر إلى أصفر */
            color: #333;
            font-weight: bold;
            padding: 12px 25px;
            border-radius: 8px;
            margin-top: 15px;
            transition: all 0.3s ease;
        }
        .final-answer-btn:hover:not(:disabled) {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(255, 215, 0, 0.4);
        }
        .final-answer-btn:disabled {
             opacity: 0.6;
            cursor: not-allowed;
        }

        /* رسائل اللعبة */
        .game-message {
            padding: 15px;
            margin-top: 20px;
            border-radius: 8px;
            font-size: 1.1rem;
            text-align: center;
        }
        .game-message.success {
            background-color: rgba(0, 176, 155, 0.8); /* أخضر شبه شفاف */
            border: 1px solid #00b09b;
        }
        .game-message.error {
            background-color: rgba(211, 16, 39, 0.8); /* أحمر شبه شفاف */
            border: 1px solid #d31027;
        }
        .game-message.info {
             background-color: rgba(106, 90, 205, 0.8); /* بنفسجي شبه شفاف */
            border: 1px solid #6a5acd;
        }

        /* تأثيرات الأنيميشن */
        @keyframes pulse-correct {
            0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(0, 176, 155, 0.7); }
            70% { transform: scale(1.02); box-shadow: 0 0 10px 15px rgba(0, 176, 155, 0); }
            100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(0, 176, 155, 0); }
        }
        @keyframes shake-incorrect {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            50% { transform: translateX(5px); }
            75% { transform: translateX(-5px); }
        }

        /* أيقونات Lucide */
        .lucide {
            width: 1em;
            height: 1em;
            display: inline-block;
            vertical-align: middle;
            margin-left: 5px; /* هامش يسار للأيقونة */
        }

        /* تصميم متجاوب */
        @media (max-width: 768px) {
            #app {
                padding: 15px;
            }
            .options button {
                padding: 12px;
                font-size: 0.9rem;
            }
            .lifelines button {
                 padding: 6px 10px;
                 font-size: 0.9rem;
            }
             .question-container {
                 padding: 15px;
                 font-size: 1rem; /* تصغير حجم خط السؤال قليلاً */
            }
             h1 {
                 font-size: 1.5rem; /* تصغير العنوان الرئيسي */
            }
            .money-tree {
                font-size: 0.85rem; /* تصغير خط شجرة المال */
            }
        }
         @media (max-width: 480px) {
             .lifelines {
                 display: flex;
                 justify-content: space-around; /* توزيع المساعدات بشكل أفضل */
             }
             .lifelines button {
                 margin: 0 2px; /* تقليل الهامش بين أزرار المساعدة */
                 padding: 5px 8px;
             }
             .final-answer-btn {
                 padding: 10px 20px;
                 font-size: 0.9rem;
             }
             .game-message {
                 font-size: 1rem;
             }
         }

    </style>
</head>
<body>
    <div id="app" class="flex flex-col md:flex-row gap-4">

        <div class="flex-grow order-2 md:order-1">
            <h1 class="text-3xl font-bold text-center mb-6 text-yellow-400">من سيربح المليون</h1>

            <div v-if="!gameStarted && !gameOver" class="text-center">
                 <img src="https://placehold.co/300x150/302b63/FFD700?text=%D9%85%D9%86+%D8%B3%D9%8A%D8%B1%D8%A8%D8%AD+%D8%A7%D9%84%D9%85%D9%84%D9%8A%D9%88%D9%86" alt="شعار اللعبة" class="mx-auto mb-6 rounded-lg border-2 border-yellow-400">
                <p class="mb-6 text-lg">هل أنت مستعد لتحدي المليون؟</p>
                <button @click="startGame" class="bg-green-500 hover:bg-green-700 text-white font-bold py-3 px-6 rounded-lg text-xl transition duration-300">
                    ابدأ اللعبة
                     <lucide name="play" class="lucide"></lucide>
                </button>
            </div>

            <div v-if="gameStarted && currentQuestion">
                <div class="question-container text-xl md:text-2xl font-semibold mb-4">
                    {{ currentQuestion.text }}
                </div>

                 <div v-if="timerActive" class="timer text-center">
                     الوقت المتبقي: {{ timerValue }} ثواني
                 </div>

                <div class="options grid grid-cols-1 md:grid-cols-2 gap-3">
                    <button
                        v-for="(option, index) in currentQuestion.options"
                        :key="index"
                        @click="selectAnswer(option, index)"
                        :disabled="answerSelected !== null || option.disabled"
                        :class="{
                            'selected': answerSelected === index,
                            'correct': revealAnswers && option.correct,
                            'incorrect': revealAnswers && !option.correct && answerSelected === index,
                            'opacity-50 cursor-not-allowed': option.disabled // لتعطيل الخيارات بعد استخدام 50:50
                        }"
                    >
                        <span class="font-bold">{{ String.fromCharCode(65 + index) }}:</span> {{ option.text }}
                    </button>
                </div>

                <div class="text-center mt-5">
                     <button @click="confirmAnswer"
                             :disabled="answerSelected === null || revealAnswers"
                             class="final-answer-btn disabled:opacity-50 disabled:cursor-not-allowed">
                         تأكيد الإجابة النهائية
                         <lucide name="check-circle" class="lucide"></lucide>
                     </button>
                 </div>


                <div class="lifelines text-center my-5">
                    <button @click="useFiftyFifty" :disabled="lifelines.fiftyFiftyUsed || revealAnswers" :class="{ 'used': lifelines.fiftyFiftyUsed }">
                        50:50
                        <lucide name="star-half" class="lucide"></lucide>
                    </button>
                    <button @click="useAudience" :disabled="lifelines.audienceUsed || revealAnswers" :class="{ 'used': lifelines.audienceUsed }">
                        سؤال الجمهور
                        <lucide name="users" class="lucide"></lucide>
                    </button>
                     <button @click="walkAway" :disabled="revealAnswers">
                         انسحاب
                         <lucide name="log-out" class="lucide"></lucide>
                     </button>
                     </div>

                 <div v-if="audiencePoll" class="game-message info mt-4">
                    <h3 class="font-bold mb-2">نتائج تصويت الجمهور:</h3>
                    <ul>
                        <li v-for="(percentage, optionIndex) in audiencePoll" :key="optionIndex">
                            {{ String.fromCharCode(65 + optionIndex) }}: {{ percentage }}%
                        </li>
                    </ul>
                </div>
            </div>

            <div v-if="gameOver" class="text-center">
                <h2 class="text-2xl font-bold mb-4" :class="{'text-green-400': gameWon, 'text-red-400': !gameWon && !walkedAway, 'text-yellow-400': walkedAway}">
                    {{ gameOverMessage }}
                </h2>
                 <p class="text-xl mb-6">
                    {{ finalWinningsMessage }}
                 </p>
                <button @click="restartGame" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg text-xl transition duration-300">
                    العب مرة أخرى
                    <lucide name="refresh-cw" class="lucide"></lucide>
                </button>
            </div>

            <div v-if="gameMessage" class="game-message" :class="gameMessage.type">
                {{ gameMessage.text }}
            </div>

        </div>

        <div class="w-full md:w-1/4 order-1 md:order-2 bg-gray-800 p-4 rounded-lg border border-gray-600 shadow-lg">
            <h3 class="text-lg font-semibold mb-3 text-yellow-400 text-center">شجرة المال</h3>
            <div class="progress-bar mb-4">
                <div class="progress-bar-inner" :style="{ width: progressPercentage + '%' }">
                    {{ Math.round(progressPercentage) }}%
                </div>
            </div>
            <ul class="money-tree">
                <li v-for="(level, index) in moneyLevels.slice().reverse()" :key="index"
                    :class="{
                        'current': gameStarted && !gameOver && currentQuestionIndex === (moneyLevels.length - 1 - index),
                        'safe-haven': level.isSafeHaven,
                        'text-gray-500': gameStarted && !gameOver && currentQuestionIndex > (moneyLevels.length - 1 - index) // للأسئلة التي تم تجاوزها
                    }">
                     <span class="font-bold">{{ moneyLevels.length - index }}.</span> {{ level.amount }}
                     <lucide v-if="level.isSafeHaven" name="shield-check" class="lucide text-green-400 ml-1"></lucide>
                     <lucide v-if="gameStarted && !gameOver && currentQuestionIndex === (moneyLevels.length - 1 - index)" name="eye" class="lucide text-blue-400 ml-1"></lucide>
                </li>
            </ul>
        </div>

    </div>

    <script>
        // تهيئة الأيقونات بعد تحميل الصفحة
        window.onload = () => {
            lucide.createIcons();

            // إعداد الأصوات (يجب أن يتم التفاعل الأول من المستخدم لتشغيل الصوت في بعض المتصفحات)
            // يتم استدعاء Tone.start() عند بدء اللعبة
        };

        new Vue({
            el: '#app',
            data: {
                gameStarted: false,
                gameOver: false,
                gameWon: false, // هل فاز بالمليون؟
                walkedAway: false, // هل انسحب؟
                currentQuestionIndex: -1,
                score: 0,
                answerSelected: null, // مؤشر الإجابة المختارة (0, 1, 2, 3)
                revealAnswers: false, // هل تم كشف الإجابات الصحيحة/الخاطئة؟
                gameMessage: null, // { text: '...', type: 'success' | 'error' | 'info' }
                lifelines: {
                    fiftyFiftyUsed: false,
                    audienceUsed: false,
                    // phoneFriendUsed: false // يمكن إضافتها لاحقاً
                },
                audiencePoll: null, // لتخزين نتائج تصويت الجمهور
                timerValue: 30, // قيمة المؤقت بالثواني
                timerInterval: null,
                timerActive: true, // هل المؤقت يعمل؟ (يمكن تعطيله)
                questions: [ // يجب أن تأتي من ملف JSON أو API في تطبيق حقيقي
                    { text: "ما هي عاصمة فرنسا؟", options: [{ text: "لندن", correct: false }, { text: "برلين", correct: false }, { text: "باريس", correct: true }, { text: "مدريد", correct: false }], level: 1 },
                    { text: "ما هو أكبر كوكب في مجموعتنا الشمسية؟", options: [{ text: "الأرض", correct: false }, { text: "المريخ", correct: false }, { text: "زحل", correct: false }, { text: "المشتري", correct: true }], level: 2 },
                    { text: "من هو مخترع المصباح الكهربائي؟", options: [{ text: "نيكولا تيسلا", correct: false }, { text: "توماس إديسون", correct: true }, { text: "ألكسندر جراهام بيل", correct: false }, { text: "ألبرت أينشتاين", correct: false }], level: 3 },
                    { text: "ما هي أطول سورة في القرآن الكريم؟", options: [{ text: "البقرة", correct: true }, { text: "آل عمران", correct: false }, { text: "النساء", correct: false }, { text: "المائدة", correct: false }], level: 4 },
                    { text: "في أي عام بدأت الحرب العالمية الأولى؟", options: [{ text: "1912", correct: false }, { text: "1914", correct: true }, { text: "1916", correct: false }, { text: "1918", correct: false }], level: 5, isSafeHaven: true }, // مستوى آمن
                    { text: "ما هو العنصر الكيميائي الذي رمزه 'O'؟", options: [{ text: "الذهب", correct: false }, { text: "الفضة", correct: false }, { text: "الأكسجين", correct: true }, { text: "الهيدروجين", correct: false }], level: 6 },
                    { text: "من رسم لوحة الموناليزا؟", options: [{ text: "مايكل أنجلو", correct: false }, { text: "ليوناردو دا فينشي", correct: true }, { text: "رافائيل", correct: false }, { text: "فان جوخ", correct: false }], level: 7 },
                    { text: "ما هو المحيط الأكبر في العالم؟", options: [{ text: "الأطلسي", correct: false }, { text: "الهندي", correct: false }, { text: "المتجمد الشمالي", correct: false }, { text: "الهادئ", correct: true }], level: 8 },
                    { text: "كم عدد الدول العربية في قارة آسيا؟", options: [{ text: "10", correct: false }, { text: "11", correct: false }, { text: "12", correct: true }, { text: "13", correct: false }], level: 9 },
                     { text: "ما هي الدولة التي لُقبت بـ 'بلاد الألف بحيرة'؟", options: [{ text: "السويد", correct: false }, { text: "فنلندا", correct: true }, { text: "النرويج", correct: false }, { text: "كندا", correct: false }], level: 10, isSafeHaven: true }, // مستوى آمن
                     { text: "من هو مؤلف كتاب 'ألف ليلة وليلة'؟", options: [{ text: "الجاحظ", correct: false }, { text: "ابن المقفع", correct: false }, { text: "غير معروف/مجموعة مؤلفين", correct: true }, { text: "المتنبي", correct: false }], level: 11 },
                     { text: "ما هي عملة اليابان؟", options: [{ text: "وون", correct: false }, { text: "يوان", correct: false }, { text: "دولار", correct: false }, { text: "ين", correct: true }], level: 12 },
                     { text: "في أي قارة تقع صحراء أتاكاما؟", options: [{ text: "أفريقيا", correct: false }, { text: "آسيا", correct: false }, { text: "أمريكا الجنوبية", correct: true }, { text: "أستراليا", correct: false }], level: 13 },
                     { text: "من هو أول رائد فضاء مشى على سطح القمر؟", options: [{ text: "يوري جاجارين", correct: false }, { text: "نيل أرمسترونج", correct: true }, { text: "باز ألدرن", correct: false }, { text: "جون جلين", correct: false }], level: 14 },
                     { text: "ما هو الاسم القديم لمدينة إسطنبول؟", options: [{ text: "أنقرة", correct: false }, { text: "بيزنطة", correct: false }, { text: "القسطنطينية", correct: true }, { text: "أزمير", correct: false }], level: 15, isSafeHaven: true }, // مستوى المليون
                ],
                moneyLevels: [ // مستويات الجوائز
                    { amount: "100 ريال", isSafeHaven: false },
                    { amount: "200 ريال", isSafeHaven: false },
                    { amount: "300 ريال", isSafeHaven: false },
                    { amount: "500 ريال", isSafeHaven: false },
                    { amount: "1,000 ريال", isSafeHaven: true }, // مستوى آمن أول
                    { amount: "2,000 ريال", isSafeHaven: false },
                    { amount: "4,000 ريال", isSafeHaven: false },
                    { amount: "8,000 ريال", isSafeHaven: false },
                    { amount: "16,000 ريال", isSafeHaven: false },
                    { amount: "32,000 ريال", isSafeHaven: true }, // مستوى آمن ثاني
                    { amount: "64,000 ريال", isSafeHaven: false },
                    { amount: "125,000 ريال", isSafeHaven: false },
                    { amount: "250,000 ريال", isSafeHaven: false },
                    { amount: "500,000 ريال", isSafeHaven: false },
                    { amount: "1,000,000 ريال", isSafeHaven: true } // المليون
                ],
                // إعدادات الأصوات
                sounds: {
                    start: null,
                    correct: null,
                    incorrect: null,
                    lifeline: null,
                    background: null, // صوت الخلفية (اختياري)
                    timerTick: null,
                    finalAnswer: null,
                    winMillion: null
                }
            },
            computed: {
                currentQuestion() {
                    // الحصول على السؤال الحالي بناءً على المؤشر
                    if (this.currentQuestionIndex >= 0 && this.currentQuestionIndex < this.questions.length) {
                        // إعادة تعيين حالة الخيارات عند عرض سؤال جديد
                        let question = this.questions[this.currentQuestionIndex];
                        question.options.forEach(opt => opt.disabled = false);
                        return question;
                    }
                    return null;
                },
                progressPercentage() {
                    // حساب نسبة التقدم في اللعبة
                    if (this.currentQuestionIndex < 0) return 0;
                    return ((this.currentQuestionIndex + 1) / this.questions.length) * 100;
                },
                currentPrize() {
                    // الحصول على قيمة الجائزة للسؤال الحالي
                    if (this.currentQuestionIndex >= 0 && this.currentQuestionIndex < this.moneyLevels.length) {
                        return this.moneyLevels[this.currentQuestionIndex].amount;
                    }
                    return "0 ريال";
                },
                safeHavenPrize() {
                    // الحصول على آخر جائزة آمنة وصل إليها اللاعب
                    let lastSafeHavenAmount = "0 ريال";
                    for (let i = this.currentQuestionIndex -1; i >= 0; i--) {
                         if (this.moneyLevels[i] && this.moneyLevels[i].isSafeHaven) {
                             lastSafeHavenAmount = this.moneyLevels[i].amount;
                             break;
                         }
                    }
                    return lastSafeHavenAmount;
                },
                 gameOverMessage() {
                     // تحديد رسالة نهاية اللعبة
                     if (this.walkedAway) {
                         return "لقد اخترت الانسحاب!";
                     } else if (this.gameWon) {
                         return "تهانينا! لقد ربحت المليون!";
                     } else if (this.gameOver) {
                         return "للأسف! إجابة خاطئة.";
                     }
                     return "";
                 },
                 finalWinningsMessage() {
                    // تحديد المبلغ النهائي الذي فاز به اللاعب
                     if (this.walkedAway) {
                         return `لقد فزت بمبلغ ${this.currentPrize}.`;
                     } else if (this.gameWon) {
                         return "أنت الآن مليونير!";
                     } else if (this.gameOver) {
                         return `لقد عدت إلى المنزل بمبلغ ${this.safeHavenPrize}.`;
                     }
                     return "";
                 }
            },
            methods: {
                // --- التحكم في الأصوات ---
                async initializeSounds() {
                    try {
                        await Tone.start(); // ضروري لبدء تشغيل الصوت بعد تفاعل المستخدم
                        console.log("Audio context started.");

                        // تعريف الأصوات باستخدام Tone.js
                        this.sounds.start = new Tone.Player({
                            url: "https://cdn.jsdelivr.net/gh/Tonejs/Tone.js/examples/audio/casio/A1.mp3", // استبدل بصوت بدء مناسب أو قم بتوليده
                            onload: () => console.log("Start sound loaded"),
                            onerror: (err) => console.error("Error loading start sound:", err)
                        }).toDestination();

                         this.sounds.correct = new Tone.Synth({
                             oscillator: { type: "sine" },
                             envelope: { attack: 0.01, decay: 0.2, sustain: 0.1, release: 0.3 }
                         }).toDestination();
                         this.sounds.correct.volume.value = -10; // خفض الصوت قليلاً

                         this.sounds.incorrect = new Tone.Synth({
                              oscillator: { type: "square" },
                              envelope: { attack: 0.01, decay: 0.4, sustain: 0, release: 0.1 }
                         }).toDestination();
                         this.sounds.incorrect.volume.value = -10;


                         this.sounds.lifeline = new Tone.Synth({
                             oscillator: { type: "triangle" },
                             envelope: { attack: 0.05, decay: 0.3, sustain: 0.1, release: 0.5 }
                         }).toDestination();
                         this.sounds.lifeline.volume.value = -8;

                         this.sounds.timerTick = new Tone.MembraneSynth({
                             pitchDecay: 0.008,
                             octaves: 2,
                             envelope: { attack: 0.001, decay: 0.1, sustain: 0 }
                         }).toDestination();
                         this.sounds.timerTick.volume.value = -15;

                         this.sounds.finalAnswer = new Tone.MetalSynth({
                             frequency: 150,
                             envelope: { attack: 0.01, decay: 0.4, release: 0.2 },
                             harmonicity: 3.1,
                             modulationIndex: 16,
                             resonance: 4000,
                             octaves: 1.5
                         }).toDestination();
                         this.sounds.finalAnswer.volume.value = -12;

                         this.sounds.winMillion = new Tone.Player({
                             url: "https://cdn.jsdelivr.net/gh/Tonejs/Tone.js/examples/audio/berklee/ah_oh.mp3", // استبدل بصوت فوز مناسب
                             onload: () => console.log("Win sound loaded"),
                             onerror: (err) => console.error("Error loading win sound:", err)
                         }).toDestination();
                         this.sounds.winMillion.volume.value = -5;


                         // يمكنك إضافة صوت خلفية إذا أردت
                         // this.sounds.background = new Tone.Player({...}).toDestination().loop = true;

                    } catch (error) {
                        console.error("Failed to start Audio Context or load sounds:", error);
                        // قد تحتاج إلى إظهار رسالة للمستخدم هنا
                        this.gameMessage = { text: "لم يتم تفعيل الصوت. قد تحتاج للنقر على الشاشة أولاً.", type: 'info' };
                    }
                },
                playSound(soundName) {
                    if (this.sounds[soundName]) {
                        try {
                            if (this.sounds[soundName] instanceof Tone.Player) {
                                this.sounds[soundName].start(Tone.now());
                            } else if (this.sounds[soundName] instanceof Tone.Synth || this.sounds[soundName] instanceof Tone.MembraneSynth || this.sounds[soundName] instanceof Tone.MetalSynth) {
                                // تحديد نغمة بسيطة للسينث
                                let note = 'C4';
                                if (soundName === 'correct') note = 'G5';
                                if (soundName === 'incorrect') note = 'C3';
                                if (soundName === 'lifeline') note = 'E4';
                                if (soundName === 'timerTick') note = 'C6';
                                if (soundName === 'finalAnswer') note = 'A3';

                                this.sounds[soundName].triggerAttackRelease(note, "8n", Tone.now());
                            }
                        } catch (error) {
                            console.error(`Error playing sound ${soundName}:`, error);
                        }
                    } else {
                        console.warn(`Sound "${soundName}" not found or not loaded.`);
                    }
                },

                // --- التحكم في اللعبة ---
                async startGame() {
                    await this.initializeSounds(); // محاولة تهيئة الصوت عند بدء اللعبة
                    this.playSound('start');
                    this.resetGameData();
                    this.gameStarted = true;
                    this.nextQuestion();
                     // if (this.sounds.background) this.sounds.background.start(); // بدء تشغيل موسيقى الخلفية
                },
                nextQuestion() {
                    this.currentQuestionIndex++;
                    this.answerSelected = null;
                    this.revealAnswers = false;
                    this.gameMessage = null;
                    this.audiencePoll = null; // إخفاء نتائج الجمهور للسؤال الجديد
                    this.resetTimer();
                    this.startTimer();
                    // تحديث أيقونات lucide إذا لزم الأمر
                    this.$nextTick(() => {
                       if (typeof lucide !== 'undefined') {
                            lucide.createIcons();
                       }
                    });
                },
                selectAnswer(option, index) {
                    if (this.revealAnswers || option.disabled) return; // لا تفعل شيئًا إذا تم كشف الإجابات أو الخيار معطل
                    this.answerSelected = index;
                    this.gameMessage = null; // إخفاء الرسائل السابقة عند اختيار إجابة جديدة
                    this.audiencePoll = null; // إخفاء نتائج الجمهور عند اختيار إجابة
                    // يمكنك إضافة صوت اختيار مبدئي هنا
                },
                confirmAnswer() {
                    if (this.answerSelected === null) return;

                    this.playSound('finalAnswer'); // صوت تثبيت الإجابة
                    this.stopTimer(); // إيقاف المؤقت عند تثبيت الإجابة
                    this.revealAnswers = true; // ابدأ في كشف الإجابات

                    const selectedOption = this.currentQuestion.options[this.answerSelected];

                    // تأخير بسيط قبل إظهار النتيجة لإعطاء تأثير درامي
                    setTimeout(() => {
                        if (selectedOption.correct) {
                            this.playSound('correct');
                            this.score = this.moneyLevels[this.currentQuestionIndex].amount; // تحديث النتيجة بالمبلغ الحالي
                            this.gameMessage = { text: `إجابة صحيحة! الجائزة الحالية: ${this.score}`, type: 'success' };

                            // التحقق مما إذا كان هذا هو السؤال الأخير (المليون)
                            if (this.currentQuestionIndex === this.questions.length - 1) {
                                this.gameWon = true;
                                this.gameOver = true;
                                this.playSound('winMillion');
                                // لا تنتقل للسؤال التالي، اللعبة انتهت بالفوز
                            } else {
                                // الانتقال للسؤال التالي بعد فترة قصيرة
                                setTimeout(() => {
                                    this.nextQuestion();
                                }, 2500); // انتظار 2.5 ثانية
                            }
                        } else {
                            this.playSound('incorrect');
                            this.gameMessage = { text: `إجابة خاطئة! الإجابة الصحيحة كانت: ${this.currentQuestion.options.find(o => o.correct).text}`, type: 'error' };
                            this.gameOver = true;
                             // if (this.sounds.background) this.sounds.background.stop(); // إيقاف موسيقى الخلفية عند الخسارة
                        }
                         // تحديث الأيقونات بعد تغيير الحالة
                        this.$nextTick(() => {
                           if (typeof lucide !== 'undefined') {
                                lucide.createIcons();
                           }
                        });
                    }, 1500); // تأخير 1.5 ثانية قبل كشف النتيجة
                },
                walkAway() {
                    this.stopTimer();
                    this.walkedAway = true;
                    this.gameOver = true;
                    this.gameMessage = { text: `لقد اخترت الانسحاب بالجائزة الحالية: ${this.currentPrize}`, type: 'info' };
                     // if (this.sounds.background) this.sounds.background.stop();
                },
                restartGame() {
                    this.resetGameData();
                    this.gameStarted = false; // العودة لشاشة البداية
                    this.gameOver = false;
                    this.gameWon = false;
                    this.walkedAway = false;
                     // تحديث الأيقونات
                     this.$nextTick(() => {
                        if (typeof lucide !== 'undefined') {
                             lucide.createIcons();
                        }
                     });
                },
                resetGameData() {
                    // إعادة تعيين بيانات اللعبة لحالة البداية
                    this.currentQuestionIndex = -1;
                    this.score = 0;
                    this.answerSelected = null;
                    this.revealAnswers = false;
                    this.gameMessage = null;
                    this.audiencePoll = null;
                    this.lifelines.fiftyFiftyUsed = false;
                    this.lifelines.audienceUsed = false;
                    this.stopTimer(); // التأكد من إيقاف أي مؤقت سابق
                    this.timerValue = 30; // إعادة تعيين قيمة المؤقت
                },

                // --- المساعدات ---
                useFiftyFifty() {
                    if (this.lifelines.fiftyFiftyUsed || this.revealAnswers) return;
                    this.playSound('lifeline');
                    this.lifelines.fiftyFiftyUsed = true;

                    const correctAnswerIndex = this.currentQuestion.options.findIndex(opt => opt.correct);
                    let incorrectIndices = [];
                    this.currentQuestion.options.forEach((opt, index) => {
                        if (!opt.correct) {
                            incorrectIndices.push(index);
                        }
                    });

                    // اختيار إجابة خاطئة واحدة عشوائيًا لتبقى
                    incorrectIndices = incorrectIndices.sort(() => 0.5 - Math.random()); // خلط عشوائي
                    const indexToKeep = incorrectIndices[0];

                    // تعطيل الإجابتين الخاطئتين الأخريين
                    this.currentQuestion.options.forEach((opt, index) => {
                         if (!opt.correct && index !== indexToKeep) {
                             // استخدام Vue.set لضمان التفاعلية عند إضافة خاصية جديدة
                             this.$set(this.currentQuestion.options[index], 'disabled', true);
                             // opt.disabled = true; // قد لا يكون تفاعليًا دائمًا في Vue 2 بدون Vue.set
                         }
                    });
                     // تحديث الأيقونات
                     this.$nextTick(() => {
                        if (typeof lucide !== 'undefined') {
                             lucide.createIcons();
                        }
                     });
                },
                useAudience() {
                    if (this.lifelines.audienceUsed || this.revealAnswers) return;
                    this.playSound('lifeline');
                    this.lifelines.audienceUsed = true;
                    this.audiencePoll = this.generateAudiencePoll();
                    this.gameMessage = { text: "تم استطلاع رأي الجمهور. انظر النتائج أدناه.", type: 'info' };
                     // تحديث الأيقونات
                     this.$nextTick(() => {
                        if (typeof lucide !== 'undefined') {
                             lucide.createIcons();
                        }
                     });
                },
                generateAudiencePoll() {
                    // محاكاة تصويت الجمهور - يعطي احتمالية أعلى للإجابة الصحيحة
                    const optionsCount = this.currentQuestion.options.length;
                    const correctAnswerIndex = this.currentQuestion.options.findIndex(opt => opt.correct);
                    let percentages = new Array(optionsCount).fill(0);
                    let remainingPercentage = 100;

                    // إعطاء حصة كبيرة للإجابة الصحيحة (بشكل عشوائي)
                    const correctPercentage = Math.floor(Math.random() * 40) + 40; // بين 40% و 79%
                    percentages[correctAnswerIndex] = correctPercentage;
                    remainingPercentage -= correctPercentage;

                    // توزيع النسبة المتبقية على الخيارات الأخرى
                    for (let i = 0; i < optionsCount; i++) {
                        if (i !== correctAnswerIndex) {
                            if (i === optionsCount - 1 || remainingPercentage <= 0) {
                                // إعطاء النسبة المتبقية للخيار الأخير
                                percentages[i] = remainingPercentage;
                            } else {
                                // إعطاء نسبة عشوائية للخيار الحالي
                                const randomPart = Math.floor(Math.random() * remainingPercentage * 0.8); // توزيع غير متساوٍ
                                percentages[i] = randomPart;
                                remainingPercentage -= randomPart;
                            }
                        }
                    }
                     // التأكد من أن المجموع 100% (قد يكون هناك خطأ بسيط في التقريب)
                     let currentSum = percentages.reduce((a, b) => a + b, 0);
                     if (currentSum !== 100 && remainingPercentage > 0) {
                         // إضافة الفرق لأي خيار غير صحيح
                         let incorrectIndex = percentages.findIndex((p, idx) => idx !== correctAnswerIndex);
                         if(incorrectIndex !== -1) percentages[incorrectIndex] += (100 - currentSum);
                     }


                    return percentages;
                },

                // --- المؤقت ---
                startTimer() {
                    if (!this.timerActive) return;
                    this.stopTimer(); // إيقاف أي مؤقت سابق
                    this.timerValue = 30; // إعادة تعيين الوقت
                    this.timerInterval = setInterval(() => {
                        this.timerValue--;
                        if (this.timerValue > 0 && this.timerValue <= 5) {
                            this.playSound('timerTick'); // تشغيل صوت التنبيه في آخر 5 ثوان
                        }
                        if (this.timerValue <= 0) {
                            this.stopTimer();
                            this.handleTimeOut();
                        }
                    }, 1000);
                },
                stopTimer() {
                    clearInterval(this.timerInterval);
                    this.timerInterval = null;
                },
                resetTimer() {
                    this.stopTimer();
                    this.timerValue = 30;
                },
                handleTimeOut() {
                     // التعامل مع انتهاء الوقت - يعتبر إجابة خاطئة
                     this.playSound('incorrect');
                     this.revealAnswers = true; // كشف الإجابة الصحيحة
                     this.gameMessage = { text: `انتهى الوقت! الإجابة الصحيحة كانت: ${this.currentQuestion.options.find(o => o.correct).text}`, type: 'error' };
                     this.gameOver = true;
                     // if (this.sounds.background) this.sounds.background.stop();
                }
            },
            mounted() {
                // يمكنك استدعاء initializeSounds هنا أيضاً، لكن يفضل عند تفاعل المستخدم الأول
                // this.initializeSounds();

                 // تحديث الأيقونات عند التحميل الأولي
                 this.$nextTick(() => {
                    if (typeof lucide !== 'undefined') {
                         lucide.createIcons();
                    }
                 });
            },
             beforeDestroy() {
                 // إيقاف المؤقت والأصوات عند تدمير المكون
                 this.stopTimer();
                 // if (this.sounds.background) this.sounds.background.stop().dispose();
                 // يمكنك إضافة dispose لبقية الأصوات إذا لزم الأمر لتنظيف الذاكرة
             }
        });
    </script>
</body>
</html>
